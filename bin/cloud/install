#!/usr/bin/env bash

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

apt update
apt install -y \
   libstdc++6 \
   python \
   python-dev \
   python3-dev \
   python-pip \
   python3-pip \
   python3-venv

python -m pip install -U pip
python3 -m pip install -U pip
pip install virtualenv
pip3 install virtualenv

apt install -y \
   build-essential \
   libgomp1 \
   gfortran \
   libmpich-dev \
   mpich \

   python3 -m pip install -U brainiak

# Install rtcloud
git clone https://github.com/brainiak/rtcloud
pushd rtcloud
python3 -m pip install .
popd

# Run scripts for master and compute
. /etc/cfncluster/cfnconfig

case ${cfn_node_type} in
   MasterServer)
      echo "MasterServer"
      ;;
   ComputeFleet)
      echo "ComputeFleet"
      ;;
esac

# Remove known host checking
echo "StrictHostKeyChecking no" >> /etc/ssh/ssh_config
echo "UserKnownHostsFile=/dev/null" >> /etc/ssh/ssh_config
