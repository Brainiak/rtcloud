#!/usr/bin/env bash

if [[ $# -ne 2 ]]; then
  echo "Usage: upload_dcm DATA_DIR SERVER_ADDRESS"
  exit 1
fi

for i in $(ls $1); do
  path=`realpath $1/$i`
  if [[ ${i: -4} == ".dcm" ]]; then
    echo Processing $path
    curl -X POST -H "Cache-Control: no-cache" -H "Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW" -F "file=@$path" "http://$2:5000/brainiak"
    sleep 0.5
  fi
done
